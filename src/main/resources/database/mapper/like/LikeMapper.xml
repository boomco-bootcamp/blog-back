<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lecture.blog.biz.service.like.repo.LikeRepository">

    <!--    게시글 좋아요 추가   -->
    <insert id="insertPostLike" parameterType="LikeSaveReqVO">
        INSERT INTO blog_post_like_l
        (
          blog_post_id
        , user_id
        , rgsn_user_id
        , rgsn_ts
        )
        VALUES
            (
              #{blogPostId}
            , #{rgsnUserId}
            , #{rgsnUserId}
            , CURRENT_TIMESTAMP
            )
    </insert>

    <!-- 게시글 좋아요 삭제 -->
    <delete id="deletePostLike" parameterType="LikeSaveReqVO">
        DELETE
        FROM blog_post_like_l
        WHERE blog_post_id = #{blogPostId}
          AND user_id = #{rgsnUserId}
    </delete>

    <!-- 게시글 좋아요 여부 확인 -->
    <select id="isPostLike" resultType="boolean" parameterType="LikeSaveReqVO">
        SELECT CASE
                   WHEN COUNT(*) > 0 THEN TRUE
                   ELSE FALSE
                   END
        FROM blog_post_like_l
        WHERE blog_post_id = #{blogPostId}
          AND user_id = #{rgsnUserId}
    </select>

</mapper>